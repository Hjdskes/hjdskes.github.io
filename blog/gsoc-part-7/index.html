<!DOCTYPE html>
<html lang="en-us">

<head>
<meta charset="utf-8">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">
<meta name="description" content="Jente Hidskes&#39; website">


<meta property="og:site_name" content="Jente Hidskes&#39; website" />
<meta property="og:locale" content="nn_NO" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://hjdskes.nl/blog/gsoc-part-7/" />
<meta property="og:title" content="GSoC part 7: the resolutions stack page" />
<meta property="twitter:title" content="GSoC part 7: the resolutions stack page">

    <meta property="twitter:card" content="summary">

<meta property="og:description" content="GSoC blog series on rewriting Piper">
<meta property="twitter:description" content="GSoC blog series on rewriting Piper">

<title>


     Jente Hidskes&#39; website - GSoC part 7: the resolutions stack page 

</title>
<link rel="canonical" href="https://hjdskes.nl/blog/gsoc-part-7/">


<style media="screen">
  @font-face {
  font-family: 'Nexa Bold';
  src: url('https://hjdskes.nl/fonts/Nexa Bold.otf');
}

html, body, div, span, applet, object, iframe,
h1, h2, h3, h4, h5, h6, p, blockquote, pre,
a, abbr, acronym, address, big, cite, code,
del, dfn, em, img, ins, kbd, q, s, samp,
small, strike, strong, sub, tt, var,
b, u, i, center,
dl, dt, dd, ol, ul, li,
fieldset, form, label, legend,
table, caption, tbody, tfoot, thead, tr, th, td,
article, aside, canvas, details, embed,
figure, figcaption, footer, header, hgroup,
menu, nav, output, ruby, section, summary,
time, mark, audio, video {
  margin: 0;
  padding: 0;
  border: 0;
  font-size: 100%;
  font: inherit;
  vertical-align: baseline;
}
/* HTML5 display-role reset for older browsers */
article, aside, details, figcaption, figure,
footer, header, hgroup, menu, nav, section, div.column {
  display: block;
}
body {
  line-height: 1;
}
ol, ul {
  list-style: none;
}
blockquote, q {
  quotes: none;
}
blockquote:before, blockquote:after,
q:before, q:after {
  content: '';
  content: none;
}
table {
  border-collapse: collapse;
  border-spacing: 0;
}

*,
*:before,
*:after {
  box-sizing: border-box;
}
a,
a:visited,
a:focus,
a:active {
  text-decoration: none;
}
html {
  height: 100%;
  font-size: 16px;
}
body {
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  -webkit-flex-direction: column;
  -moz-flex-direction: column;
  -ms-flex-direction: column;
  flex-direction: column;
  -webkit-align-items: center;
  -moz-align-items: center;
  -ms-align-items: center;
  align-items: center;
  -webkit-justify-content: flex-start;
  -moz-justify-content: flex-start;
  -ms-justify-content: flex-start;
  justify-content: flex-start;
  width: 100%;
  min-height: 100%;
  font-weight: 400;
  font-family: 'Helvetica Neue', 'Arial', sans-serif;
  color: #111111;
  line-height: 1.6;
  text-rendering: optimizeLegibility !important;
}
.icon {
  text-rendering: geometricPrecision !important;
}
section {
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  -webkit-justify-content: center;
  -moz-justify-content: center;
  -ms-justify-content: center;
  justify-content: center;
  -webkit-align-items: center;
  -moz-align-items: center;
  -ms-align-items: center;
  align-items: center;
  width: 100%;
}
div.column {
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  -webkit-justify-content: center;
  -moz-justify-content: center;
  -ms-justify-content: center;
  justify-content: center;
  -webkit-align-items: center;
  -moz-align-items: center;
  -ms-align-items: center;
  align-items: center;
  width: 100%;
}
.container {
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  width: 100%;
}
div.header .container {
  -webkit-align-items: center;
  -moz-align-items: center;
  -ms-align-items: center;
  align-items: center;
  -webkit-justify-content: center;
  -moz-justify-content: center;
  -ms-justify-content: center;
  justify-content: center;
}
div.header .content {
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  -webkit-flex-direction: column;
  -moz-flex-direction: column;
  -ms-flex-direction: column;
  flex-direction: column;
  -webkit-align-items: center;
  -moz-align-items: center;
  -ms-align-items: center;
  align-items: center;
}
div.header .container .logo {
  max-width: 100px;
  margin-left: -2em;
}
div.header .name {
  padding-top: 20px;
  font-size: 28px;
  font-family: 'Nexa Bold', 'Helvetica Neue', 'Arial', sans-serif;
  letter-spacing: -0.005rem;
  text-transform: uppercase;
  -moz-osx-font-smoothing: grayscale;
  -webkit-font-smoothing: antialiased;
  font-smoothing: antialiased;
  color: #333333;
  color: #555555;
}
div.header nav {
  margin-bottom: 16px;
}
div.header nav ul {
  list-style: none;
  text-align: center;
  display: -webkit-inline-flex;
  display: -moz-inline-flex;
  display: -ms-inline-flexbox;
  display: -ms-inline-flex;
  display: inline-flex;
}
div.header nav ul li {
  margin-left: 6px;
  margin-right: 6px;
}
div.header nav ul li:first-child {
  margin-left: 0;
}
div.header nav ul li:last-child {
  margin-right: 0;
}
div.header nav ul a {
  color: #555555;
  font-weight: 400;
  font-size: 14px;
  text-transform: uppercase;
  font-family: 'Helvetica Neue', 'Arial', sans-serif;
  -webkit-transition: color 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
  -moz-transition: color 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
  -ms-transition: color 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
  -o-transition: color 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
}
div.header nav ul a:hover {
  color: #111111;
}
div.footer .container {
  -webkit-align-items: center;
  -moz-align-items: center;
  -ms-align-items: center;
  align-items: center;
  -webkit-justify-content: center;
  -moz-justify-content: center;
  -ms-justify-content: center;
  justify-content: center;
  flex-direction: column-reverse;
  width: 100%;
  text-align: center;
}
div.footer .container a {
  font-size: 14px;
  margin-left: 6px;
  margin-right: 6px;
  opacity: 0.6;
  -webkit-transition: opacity 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
  -moz-transition: opacity 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
  -ms-transition: opacity 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
  -o-transition: opacity 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
}
div.footer .container a:first-child {
  margin-left: 0;
}
div.footer .container a:last-child {
  margin-right: 0;
}
div.footer .container a:hover {
  opacity: 0.8;
}
div.footer .container a .icon {
  width: 16px;
  height: 16px;
}
div.footer .container .copyright {
  flex-grow: 0.5;
  text-align: start;
}
div.footer .container .icons {
  flex-grow: 0.5;
  text-align: end;
}
div.main .container {
  -webkit-align-items: center;
  -moz-align-items: center;
  -ms-align-items: center;
  align-items: center;
  -webkit-justify-content: flex-start;
  -moz-justify-content: flex-start;
  -ms-justify-content: flex-start;
  justify-content: flex-start;
}
div.main .content {
  color: #111111;
  font-size: 16px;
}
div.main .content .title-container {
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  -webkit-justify-content: space-between;
  -moz-justify-content: space-between;
  -ms-justify-content: space-between;
  justify-content: space-between;
}
div.main .content .posts {
  margin-bottom: 4em;
}
div.main .content .page-heading {
  font-size: 20px;
  font-weight: 700;
  font-family: 'Helvetica Neue', 'Arial', sans-serif;
  letter-spacing: -0.005rem;
  text-transform: uppercase;
  -moz-osx-font-smoothing: grayscale;
  -webkit-font-smoothing: antialiased;
  font-smoothing: antialiased;
  color: #333333;
  margin-bottom: 16px;
}
div.main .content .front-matter .page-heading {
  margin-bottom: 0;
}
div.main .content .front-matter .meta {
  font-size: 14px;
  color: #666666;
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  margin-bottom: 32px;
}
div.main .content .front-matter .date,
div.main .content .front-matter .author,
div.main .content .front-matter .tags,
div.main .content .front-matter .word-count,
div.main .content .front-matter .middot:before {
  display: none;
}
div.main .content .front-matter .middot:before {
  font-size: 6px;
  margin: 0 6px;
  vertical-align: middle;
  content: "•";
}
div.main .content .front-matter .tags ul {
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  -webkit-flex-direction: row;
  -moz-flex-direction: row;
  -ms-flex-direction: row;
  flex-direction: row;
  -webkit-align-items: center;
  -moz-align-items: center;
  -ms-align-items: center;
  align-items: center;
}
div.main .content .front-matter .tags ul li {
  -webkit-transition: opacity 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
  -moz-transition: opacity 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
  -ms-transition: opacity 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
  -o-transition: opacity 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
}
div.main .content .front-matter .tags ul li:hover {
  opacity: 0.7;
}
div.main .content .front-matter .tags ul li a {
  color: #666666;
}
div.main .container.f04 {
  -webkit-justify-content: center;
  -moz-justify-content: center;
  -ms-justify-content: center;
  justify-content: center;
}
div.main .container.f04 .content {
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  -webkit-flex-direction: column;
  -moz-flex-direction: column;
  -ms-flex-direction: column;
  flex-direction: column;
  -webkit-align-items: center;
  -moz-align-items: center;
  -ms-align-items: center;
  align-items: center;
}
div.main .container.f04 .content .num {
  margin: 30px 0px 30px 0;
  font-weight: 400;
  font-family: 'Helvetica Neue', 'Arial', sans-serif;
  font-size: 50px;
}
div.main .container.f04 .content .detail {
  margin-bottom: 40px;
}
div.main .container .content .groupby {
  margin-top: 1em;
  padding-left: 0.5em;
}
div.main .container .content .post-item {
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  -webkit-align-items: center;
  -moz-align-items: center;
  -ms-align-items: center;
  align-items: center;
  display: list-item;
  list-style: disc inside;
}
div.main .container .content .post-item .meta {
  font-size: 14px;
  color: #666666;
  display: none;
  min-width: 100px;
}
div.main .container .content .see-more {
  font-style: italic;
  float: right;
  font-size: 0.9em;
  margin-top: 2em;
  color: #313537;
}
div.main .container .content .see-more:hover {
  color: #666;
}
section {
  padding: 0 16px;
}
div.column {
  padding: 0 16px;
}
div.header {
  padding-top: 10px;
}
div.header-home {
  padding-top: 36px;
}
div.main {
  padding-top: 32px;
}
div.main .container .content .post-item .meta {
    display: block;
}
div.main .container .content .post-item {
    display: flex;
    list-style: none;
}
a {
  color: #428bca;
  -webkit-transition: color 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
  -moz-transition: color 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
  -ms-transition: color 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
  -o-transition: color 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
}
a:hover {
  color: #2a6496;
}
img {
  max-width: 100%;
}
div.main .content {
    width: 100%;
}
div.main .content .markdown {
  font-size: 1.1em;
  line-height: 1.75em;
  color: #313537;
  font-family: serif;
  font-weight: 300;
}
div.main .content .markdown h1,
div.main .content .markdown h2,
div.main .content .markdown h3,
div.main .content .markdown h4,
div.main .content .markdown h5,
div.main .content .markdown h6 {
  font-size: 22px;
  font-family: 'Helvetica Neue', 'Arial', sans-serif;
  letter-spacing: -0.005rem;
  font-weight: 700;
  -moz-osx-font-smoothing: grayscale;
  -webkit-font-smoothing: antialiased;
  font-smoothing: antialiased;
  color: #333333;
  text-transform: none;
  margin-top: 1.75rem;
}
div.main .content .markdown h1 {
  font-size: 1.75rem;
  margin-bottom: 2rem;
}
div.main .content .markdown h2 {
  font-size: 1.5rem;
  margin-bottom: 1.5rem;
}
div.main .content .markdown h3 {
  font-size: 1em;
  margin-bottom: 1rem;
}
div.main .content .markdown h4,
div.main .content .markdown h5,
div.main .content .markdown h6 {
  font-size: 1rem;
  margin-bottom: 1rem;
  letter-spacing: none;
}
div.main .content .markdown code,
div.main .content .markdown pre {
  font-family: 'Menlo', monospace;
  font-size: 0.98rem;
  background-color: #f7f7f7;
}
div.main .content .markdown code {
  /* enclosed by single backtick (`) */
  padding: .15em .5em;
  border-radius: 2px;
}
div.main .content .markdown pre {
  /* Hugo specific: consider using the 'highlight' shortcode */
  display: block;
  margin-top: 1rem;
  margin-bottom: 2rem;
  padding: 1rem;
  line-height: 1.5em;
  white-space: pre;
  word-break: break-all;
  word-wrap: break-word;
}
div.main .content .markdown pre code {
  /* enclosed by 4 backticks (````) */
  padding: 0;
  font-size: 0.9rem;
}
div.main .content .markdown a code {
  color: #428bca !important;
}
div.main .content .markdown a code:hover {
  text-decoration: underline;
}
div.main .content .markdown p {
  
  text-align: justify;
  
  margin-top: 0;
  margin-bottom: 1em;
}
div.main .content .markdown ul,
div.main .content .markdown ol,
div.main .content .markdown dl {
  margin-top: 1rem;
  margin-bottom: 2rem;
}
div.main .content .markdown dt {
  font-weight: bold;
}
div.main .content .markdown dd {
  margin-bottom: .5rem;
}
div.main .content .markdown ul {
  list-style-type: disc;
  list-style-position: outside;
  margin-bottom: 1.25rem;
}
div.main .content .markdown ol {
  list-style-type: decimal;
  margin-bottom: 1.25rem;
}
div.main .content .markdown li {
  margin-left: 2em;
}
div.main .content .markdown em {
  font-style: italic;
}
div.main .content .markdown strong {
  font-weight: 700;
}
div.main .content .markdown hr {
  position: relative;
  margin: 1.75rem 0;
  border: 0;
  border-top: 1px solid #808080;
  border-top: 1px solid #999999;
}
div.main .content .markdown abbr {
  font-size: 0.85rem;
  font-weight: bold;
  color: #666666;
  text-transform: uppercase;
}
div.main .content .markdown abbr[title] {
  cursor: help;
  border-bottom: 1px dotted #808080;
}
div.main .content .markdown blockquote {
  padding: .5rem 1rem;
  margin: .8rem 0;
  color: #7a7a7a;
  border-left: .25rem solid #e5e5e5;
}
div.main .content .markdown blockquote p:last-child {
  margin-bottom: 0;
}
div.main .content .markdown figure {
  width: 100%;
  background: #fff;
  margin-bottom: 1em;
}
div.main .content .markdown figure img {
  width: 100%;
  height: auto;
  max-width: 100%;
  display: block;
  position: static;
  margin: auto;
}
div.main .content .markdown table {
  margin-bottom: 1rem;
  width: 100%;
  border: 1px solid #e5e5e5;
  border-collapse: collapse;
}
div.main .content .markdown td,
div.main .content .markdown th {
  padding: .25rem .5rem;
  border: 1px solid #e5e5e5;
}
div.main .content .markdown tbody tr:nth-child(odd) td,
div.main .content .markdown tbody tr:nth-child(odd) th {
  background-color: #f7f7f7;
}
div.main .content .markdown .footnotes ol {
  list-style-type: decimal;
  margin-left: 16px;
}
div.main .content .markdown .footnotes li {
  list-style-type: unset;
}
div.main .content .markdown .footnote-ref {
  font-size: 0.7em;
}
div.main .content .navigation {
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  -webkit-flex-direction: column;
  -moz-flex-direction: column;
  -ms-flex-direction: column;
  flex-direction: column;
  -webkit-align-items: center;
  -moz-align-items: center;
  -ms-align-items: center;
  align-items: center;
  padding: 2em;
}
div.main .content .navigation div {
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  -webkit-flex-direction: row;
  -moz-flex-direction: row;
  -ms-flex-direction: row;
  flex-direction: row;
  -webkit-align-items: center;
  -moz-align-items: center;
  -ms-align-items: center;
  align-items: center;
  margin-top: 1em;
}
div.main .content .navigation .icon {
  width: 16px;
  height: 16px;
}
div.main .content .navigation a {
  width: 250px;
  margin: 0 1em;
  text-align: center;
  font-style: italic;
  color: #313537;
}
div.main .content .share, div.main .content .share div {
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  -webkit-flex-direction: row;
  -moz-flex-direction: row;
  -ms-flex-direction: row;
  flex-direction: row;
  -webkit-align-items: center;
  -moz-align-items: center;
  -ms-align-items: center;
  align-items: center;
  justify-content: center;
}
div.main .content .share {
  background-color: rgba(152, 152, 152, 0.07);
  padding: 1em 0;
}
div.main .content .share a {
  margin: 0 6px;
}
kbd {
  padding: 0.1em 0.6em;
  border: 1px solid #ccc;
  font-size: 11px;
  font-family: Arial,Helvetica,sans-serif;
  background-color: #f7f7f7;
  color: #333;
  -moz-box-shadow: 0 1px 0px rgba(0, 0, 0, 0.2),0 0 0 2px #ffffff inset;
  -webkit-box-shadow: 0 1px 0px rgba(0, 0, 0, 0.2),0 0 0 2px #ffffff inset;
  box-shadow: 0 1px 0px rgba(0, 0, 0, 0.2),0 0 0 2px #ffffff inset;
  -moz-border-radius: 3px;
  -webkit-border-radius: 3px;
  border-radius: 3px;
  display: inline-block;
  margin: 0 0.1em;
  text-shadow: 0 1px 0 #fff;
  line-height: 1.4;
  white-space: nowrap;
}

/* Fonts */



</style>
<style media="(min-width: 600px)">
  body {
-webkit-justify-content: center;
-moz-justify-content: center;
-ms-justify-content: center;
justify-content: center;
}
.non-narrow.zero-top-spacing {
padding-top: 0 !important;
}
section {
padding: 0 16px;
margin-left: 100px;
margin-right: 100px;
max-width: 750px;
}
div.column {
padding: 0 16px;
margin-left: 100px;
margin-right: 100px;
max-width: 750px;
}
div.header {
background-color: transparent;
}
div.header .container {
-webkit-justify-content: flex-start;
-moz-justify-content: flex-start;
-ms-justify-content: flex-start;
justify-content: flex-start;
}
div.header .container .logo {
margin: 0;
}
div.header-home .container .logo {
max-width: 180px;
margin-left: 20px;
}
div.header-home .name-home {
padding-top: 30px;
font-size: 40px;
}
div.header-home nav ul a {
font-size: 18px;
}
div.header .content {
-webkit-align-items: flex-start;
-moz-align-items: flex-start;
-ms-align-items: flex-start;
align-items: flex-start;
}
div.header .name {
color: #333333;
}
div.header nav {
font-size: 14px;
margin-bottom: 0;
}
div.header nav ul {
text-align: left;
}
div.header nav ul a {
color: #666666;
}
div.header nav ul a:hover {
color: #333333;
}
div.footer {
background-color: transparent;
}
div.footer .container {
flex-direction: row;
}
div.footer .container a {
margin-left: 3px;
margin-right: 3px;
color: #666666;
}
div.footer .container a:hover {
color: #333333;
}
div.footer .container a .icon {
font-size: 18px;
}
div.footer .container a .icon.larger {
font-size: 20px;
}
div.main .content .front-matter .date,
div.main .content .front-matter .author,
div.main .content .front-matter .tags,
div.main .content .front-matter .word-count,
div.main .content .front-matter .middot:before {
display: initial;
}
div.main .container.f04 {
-webkit-justify-content: flex-start;
-moz-justify-content: flex-start;
-ms-justify-content: flex-start;
justify-content: flex-start;
}
div.main .container.f04 .content {
-webkit-align-items: flex-start;
-moz-align-items: flex-start;
-ms-align-items: flex-start;
align-items: flex-start;
}
div.main .container.f04 .content .num {
margin: 0 0 10px 0;
font-size: 32px;
}
div.main .container.f04 .content .detail {
margin-bottom: 30px;
}
.container {
padding: 0 30px;
}
div.header {
padding-top: 60px;
padding-bottom: 60px;
}
div.footer {
padding-top: 30px;
padding-bottom: 60px;
}
div.main {
padding-top: 0;
}
div.main .container .content .post-item {
display: flex;
list-style: none;
padding-left: 1.5em;
}
div.main .container .content .post-item .meta {
display: block;
}
div.main.post {
padding-top: 60px;
padding-bottom: 60px;
}
div.main .content .markdown blockquote {
padding-right: 5rem;
padding-left: 1.25rem;
}
div.main .content .navigation {
-webkit-flex-direction: row;
-moz-flex-direction: row;
-ms-flex-direction: row;
flex-direction: row;
}
div.main .content .navigation div {
margin-top: 0em;
}

</style>
<style media="(min-width: 769px)">
  div.main .content .markdown figure {
width: 110%;
margin-left: -4%;
}
div.main .content .markdown img {
max-width: 110%;
width: 110%;
margin-left: -4%;
}
div.main .content .markdown pre {
width: 110%;
margin-left: -4%;
}

</style>

<noscript>
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,700" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Merriweather:300,300i,700,700i" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700" rel="stylesheet">
</noscript>


  <style type="text/css" media="screen">
    .hljs-comment,.hljs-quote{color:#8e908c}.hljs-variable,.hljs-template-variable,.hljs-tag,.hljs-name,.hljs-selector-id,.hljs-selector-class,.hljs-regexp,.hljs-deletion{color:#c82829}.hljs-number,.hljs-built_in,.hljs-builtin-name,.hljs-literal,.hljs-type,.hljs-params,.hljs-meta,.hljs-link{color:#f5871f}.hljs-attribute{color:#eab700}.hljs-string,.hljs-symbol,.hljs-bullet,.hljs-addition{color:#718c00}.hljs-title,.hljs-section{color:#4271ae}.hljs-keyword,.hljs-selector-tag{color:#8959a8}.hljs{display:block;overflow-x:auto;background:white;color:#4d4d4c;padding:0.5em}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:bold}
  </style>









  <link rel="stylesheet" href="https://hjdskes.nl/css/message.css">

  <link rel="stylesheet" href="https://hjdskes.nl/css/gallery.css">

  <link rel="stylesheet" href="https://hjdskes.nl/css/cocoa-eh-fixes.css">





<link rel="shortcut icon"

    href="https://hjdskes.nl/img/favicon.ico"

>




</head>


<body>


<div class="header column">

    <div class="container">
        <a href="https://hjdskes.nl/"><img class="logo" src="https://hjdskes.nl/img/avatar.png" alt="logo" /></a>
        <div class="content">
            <a href="https://hjdskes.nl/"><div class="name"><h1>Jente Hidskes&#39; website</h1></div></a>
            <nav>
                <ul>
                    
                        <li><a href="https://hjdskes.nl/blog/">Blog</a></li>
                    
                    
                        
                            
                        
                    
                        
                            
                            <li><a href="https://hjdskes.nl/contributions">contributions</a></li>
                            
                        
                    
                        
                            
                            <li><a href="https://hjdskes.nl/projects">projects</a></li>
                            
                        
                    
                    
                        
                            <li><a href="https://hjdskes.nl/about/">About me</a></li>
                        
                    
                        
                    
                        
                    
                </ul>
            </nav>
        </div>
    </div>
</div>


<div class="main post non-narrow zero-top-spacing column">
    <div class="container">
        <div class="content">
            <div class="front-matter">
                <div class="title-container">
                    <div class="page-heading">

    GSoC part 7: the resolutions stack page

</div>

                </div>
                <div class="meta">
                    <div class="date" title="Fri Jul 7 2017 14:58:33 CEST">Jul 7, 2017</div>
                    
                        
                    
                    <div class="reading-time middot">8 minute read</div>
                    <div class="tags">
                        <ul>
                          
                            <li class="middot"><a href="/tags/piper">Piper</a> </li>
                          
                            <li class="middot"><a href="/tags/fdo">fdo</a> </li>
                          
                            <li class="middot"><a href="/tags/mousemap">MouseMap</a> </li>
                          
                            <li class="middot"><a href="/tags/resolutions">resolutions</a> </li>
                          
                            <li class="middot"><a href="/tags/pygi">pygi</a> </li>
                          
                            <li class="middot"><a href="/tags/template">template</a> </li>
                          
                        </ul>
                    </div>
                    <div class="tags">
                        <ul>
                          
                          
                        </ul>
                    </div>
                </div>
            </div>
            <div class="markdown">
                
    

<p><img src="/img/blog/gsoc-part-1/GSoC-logo-horizontal.svg" alt="GSoC logo horizontal" /></p>

<p>This week was a good week with loads of progress. I&rsquo;ll just go through each item
one by one, as usual.</p>

<h3 id="mousemap-merged">MouseMap merged</h3>

<p>Last Friday I opened the pull request to merge the MouseMap widget. After a bit
of a discussion around preferences, my mentor and I decided to merge ongoing
work in a <code>rewrite</code> branch. This keeps the master branch functional (while still
receiving improvements, such as adding new functionality to the ratbagd bindings
or <a href="https://github.com/libratbag/piper/pull/24">a Gtk.Application subclass</a>), but it also prevents reviewing
the same pieces of code over and over until they finally end up in master.</p>

<p>With the MouseMap finally done, it was time to get started on the real work:
implementing the mockups!</p>

<h3 id="pygi-composite-templates-or-using-gtk-composite-templates-for-python">pygi_composite_templates, or: using Gtk+ composite templates for Python</h3>

<p>GtkBuilder <a href="https://wiki.gnome.org/HowDoI/CustomWidgets#Templates">templates</a> allow you to define your composite (composed
of other widgets) widget through <code>.ui</code> files, which are XML files generated by
<a href="https://glade.gnome.org/">Glade</a>.  This is nice in that it removes all the boilerplate code that
creates widgets, sets their properties and connects their signals. Instead, you:</p>

<ol>
<li>Call <code>gtk_widget_init_template</code> in your widget&rsquo;s <code>_init</code> function;</li>
<li>Call <code>gtk_widget_set_template</code> or <code>gtk_widget_set_template_from_resource</code> in your widget&rsquo;s <code>_class_init</code> function;</li>
<li>Call <code>gtk_widget_class_bind_template_child</code> (or one of its variants) as needed for all members that you need to access.</li>
</ol>

<p>Nice right? Well, <a href="https://bugzilla.gnome.org/show_bug.cgi?id=701843">not for Python</a>. That is, not officially:
<a href="https://github.com/virtuald/pygi-composite-templates/"><code>pygi_composite_templates</code></a> is prototype implementation of Gtk+
composite widget templates for PyGI. In an experiment I&rsquo;ve tried how this works
for Piper, and fortunately I haven&rsquo;t noticed any issues yet! Thanks to templates
the UI code is now significantly cleaner and easier to comprehend, not to
mention there is much less of it as well.</p>

<p>There was only one issue with <code>gi_composite</code> when I tried it: it wouldn&rsquo;t find
Piper&rsquo;s <code>.ui</code> file, even though it was declared in <code>piper.gresource.xml</code> which
gets added to <a href="https://github.com/libratbag/piper/blob/master/piper.in#L48">Gio&rsquo;s resources</a>. I contacted Dustin,
<code>gi_composite</code>&rsquo;s author, who kindly responded:</p>

<blockquote>
<p>One thing you might try is ensuring that your resource is registered <em>before</em>
your ui class type is created &ndash; note that I said type, not instance. If I
recall correctly, I think the ui file may be needed when the class type is
created&hellip; which is when the interpreter executes the line with &lsquo;class Foo&rsquo; on
it.</p>
</blockquote>

<p>And indeed, <a href="https://github.com/libratbag/piper/pull/28/commits/cbc546dc945f9bbdbf4bd3671dc25219d3a3208b#diff-07d882117a676ac39c6d2cee78a8876aR40">shuffling</a> some lines around so that the resource gets added before
anything else does the trick! The complete implementation of this can be found
in <a href="https://github.com/libratbag/piper/pull/28/commits/cbc546dc945f9bbdbf4bd3671dc25219d3a3208b">this</a> commit.</p>

<h3 id="the-resolutions-page">The resolutions page</h3>

<p>This all paved the way to implementing the first page of the mockups: the
resolutions page! In doing so I encountered multiple little obstacles that I
resolved along the way, but let&rsquo;s first run through the resolutions page.</p>

<p>The UI elements are all defined in <code>.ui</code> files, keeping the code blissfully
clean (trust me *Star Wars wave*). In fact, the complete Python code weighs in
at just around 200 lines. So, what does it do? Well, this:</p>

<video controls>
  <source src="/img/blog/gsoc-part-7/resolutions.webm" type="video/webm">
Your browser does not support the video tag.
</video>

<p>In case committing the changes to the device doesn&rsquo;t succeed, there&rsquo;s also an
<a href="https://developer.gnome.org/hig/stable/in-app-notifications.html.en">in-app notification</a> that informs the user as such:</p>

<p><img src="/img/blog/gsoc-part-7/notification.png" alt="In-app notification" /></p>

<h4 id="obstacle-1-no-support-for-adding-or-removing-resolutions">Obstacle 1: no support for adding or removing resolutions</h4>

<p>According to the <a href="https://github.com/libratbag/piper/raw/wiki/redesign/resolution.png">mockups</a>, Piper should be able to add and remove (or
enable and disable, if the device doesn&rsquo;t support this) resolutions. It turns
out, however, that <a href="https://github.com/libratbag/libratbag/issues/211">this isn&rsquo;t yet supported by libratbag</a>. The
buttons are there, and until this is supported they will just print a message to
<code>stdout</code>.</p>

<h4 id="obstacle-2-a-commit-method">Obstacle 2: a commit method</h4>

<p>While working on the above changes, I noticed that any changes made were not
saved on my device. Then I remembered that libratbag has a commit-style API: any
changes made are not stored on the device unless explicitly committed. Ratbagd,
however, didn&rsquo;t expose this method yet, so I had to add it.</p>

<p>The ratbagd PR is <a href="https://github.com/libratbag/libratbag/pull/199">here</a>, and the Piper bindings commit is
<a href="https://github.com/libratbag/piper/pull/26">here</a>.</p>

<h4 id="obstacle-3-error-codes-and-using-the-correct-resolution-setter">Obstacle 3: error codes, and using the correct resolution setter</h4>

<p>Once the commit method had been added everywhere, my changes <em>still</em> weren&rsquo;t
saved on the device (sidenote: I did find <a href="https://github.com/libratbag/libratbag/issues/205">this bug</a>).
Benjamin helped me in figuring out why; it turned out that ratbagd
unconditionally used the <code>ratbag_resolution_set_dpi_xy</code> method, which is meant
for devices that support separate x- and y-resolutions, which my device doesn&rsquo;t.
Benjamin <a href="https://github.com/libratbag/libratbag/pull/201">fixed</a> this, and I added support for libratbag&rsquo;s
<a href="https://github.com/libratbag/piper/pull/26">error codes</a> to Piper&rsquo;s ratbagd bindings such that these cases
are noticed in the future (yes, this and the commit method were solved
simultaneously).</p>

<h4 id="obstacle-4-does-every-resolution-have-its-own-report-rate">Obstacle 4: does every resolution have its own report rate?</h4>

<p>With the resolution list working, I started on the report rate. The
<a href="https://github.com/libratbag/piper/raw/wiki/redesign/resolution.png">mockups</a> show that the report rates work per profile, across all that
profile&rsquo;s resolutions. Ratbagd&rsquo;s DBus API, however, has a <code>SetReportRate</code> method
for every resolution. To discuss this I opened <a href="https://github.com/libratbag/libratbag/issues/197">this issue</a>; the
concensus for now is to support the per profile report rate. This isn&rsquo;t
implemented in ratbagd (<a href="https://github.com/libratbag/libratbag/issues/202">yet?</a>), so for now Piper is the
odd one out by making sure that a changed report rate is propagated to all a
profile&rsquo;s resolutions.</p>

<h4 id="obstacle-5-drawing-only-leaders-that-have-children">Obstacle 5: drawing only leaders that have children</h4>

<p>Before this week, the MouseMap unconditionally drew all the leaders in the SVG.
The resolutions page needs to indicate which button(s) is (are) assigned to
switch resolutions, so it adds less children than there are buttons on the
device (unless every button is assigned to switch resolutions&hellip;). To draw only
leaders that have children, the paths and their origin square in the SVG are
grouped and this group is given the identifier <code>buttonX-path</code> (or <code>ledX-path</code>),
and the MouseMap&rsquo;s <code>_draw_device</code> method is adjusted:</p>

<pre><code class="language-diff">@@ -391,4 +398,6 @@ def _draw_device(self, cr):
              self._handle.render_cairo_sub(highlight_context,
                                            self._highlight_element)
              cr.mask_surface(highlight_surface, 0, 0)
 -        self._handle.render_cairo_sub(cr, id=self._layer)
 +        for child in self._children:
 +            self._handle.render_cairo_sub(cr, id=child.svg_path)
 +            self._handle.render_cairo_sub(cr, id=child.svg_leader)
</code></pre>

<p>Finally, to find buttons that are assigned to switch resolutions:</p>

<pre><code class="language-python">mousemap = MouseMap(&quot;#Buttons&quot;, self._device, spacing=20, border_width=20)
for button in profile.buttons:
    if button.action_type == &quot;special&quot; and button.special == &quot;resolution-default&quot;:
        label = Gtk.Label(_(&quot;Switch resolution&quot;))
        mousemap.add(label, &quot;#button{}&quot;.format(button.index))
</code></pre>

<h4 id="obstacle-6-keep-scrolling-the-list-when-the-cursor-hovers-a-scale">Obstacle 6: keep scrolling the list when the cursor hovers a scale</h4>

<p>As you can see in the video, the list contains scales (<q>sliders</q>). If, when
scrolling the list, the cursor hovers a scale, the scale would consume the
scroll event. Not nice. To work around this, we capture the scroll event and
block the signal on the scale:</p>

<pre><code class="language-python">@GtkTemplate.Callback
def _on_scroll_event(self, widget, event):
    # Prevent a scroll in the list to get caught by the scale
    GObject.signal_stop_emission_by_name(widget, &quot;scroll-event&quot;)
    return False
</code></pre>

<h4 id="obstacle-7-adjusting-the-scale-in-multiples-of-50-dpi">Obstacle 7: adjusting the scale in multiples of 50 DPI</h4>

<p>Most mice only support a resolution in multiples of 50 DPI; anything less than
that doesn&rsquo;t make much sense. The <code>Gtk.Scale</code> wouldn&rsquo;t adhere to its
<code>Gtk.Adjustment</code>&rsquo;s <code>step-increment</code> property, even though it was set. Weirdly,
it does adhere to the <code>page-increment</code> property. After asking around on <code>#gtk+</code>,
I ended up connecting to the <code>change-value</code> signal, which is emitted when a
scroll action is performed on a range (a <a href="https://lazka.github.io/pgi-docs/#Gtk-3.0/enums.html#Gtk.ScrollType">scroll action</a> can be
anything, really). The signal handler receives the new value, which we can round
to the nearest multiple of 50 before setting it on the scale:</p>

<pre><code class="language-python">@GtkTemplate.Callback
def _on_change_value(self, scale, scroll, value):
    # Round the value resulting from a scroll event to the nearest multiple
    # of 50. This is to work around the Gtk.Scale not snapping to its
    # Gtk.Adjustment's step_increment.
    scale.set_value(int(value - (value % 50)))
    return True
</code></pre>

<h3 id="theming-in-ratbagd">Theming in ratbagd</h3>

<p>This week ratbagd <a href="https://github.com/libratbag/piper/pull/29">got</a> support for different SVG themes. The
reasoning behind this is that Piper, an application intended to integrate with
the GNOME Desktop Environment, prefers a different style of SVGs than a
hypothetical KDE version (Kiper? &#128521;) would.</p>

<p>The linked PR adds a new DBus property
<code>org.freedesktop.ratbagd1.Manager.Themes</code>, which returns a string array of
themes installed with libratbag; currently <code>default</code> and <code>gnome</code>.
<code>org.freedesktop.ratbagd1.Device</code> got a new method <code>GetSvg(string)</code>, which takes
a theme and returns the full path to the device SVG for the given theme.</p>

<p>There was a <a href="https://github.com/libratbag/libratbag/pull/182">long lasting PR</a> open on libratbag to convert all
SVGs to the toned down style as preferred by Piper (together with issues
<a href="https://github.com/libratbag/libratbag/issues/178">178</a> and <a href="https://github.com/libratbag/libratbag/issues/171">171</a>). This PR was rebased on top of the theme changes,
after <a href="https://github.com/libratbag/libratbag/pull/212">moving the default SVGs to their theme directory</a>, which
probably wasn&rsquo;t done in the theme PR as an oversight.</p>

<p>The GNOME theme currently sports three device SVGs. If you are familiar with
Inkscape and willing to do a few; feel free! <a href="https://github.com/libratbag/libratbag/issues/213">Here</a> is the list of
devices that aren&rsquo;t yet found in the GNOME theme.</p>

<p>Today I quickly <a href="https://github.com/libratbag/piper/pull/29">added</a> theme support to Piper&rsquo;s ratbagd
bindings, so that the MouseMap can be adjusted and everything will work with the
new libratbag master.</p>

<p>The changes required to the MouseMap are rather straightforward:</p>

<pre><code class="language-diff">--- a/piper/mousemap.py
+++ b/piper/mousemap.py
@@ -106,7 +106,8 @@ class MouseMap(Gtk.Container):
             raise ValueError(&quot;Layer cannot be None&quot;)
         if ratbagd_device is None:
             raise ValueError(&quot;Device cannot be None&quot;)
-        if not os.path.isfile(ratbagd_device.svg_path):
+        svg_path = ratbagd_device.get_svg(&quot;gnome&quot;)
+        if not os.path.isfile(svg_path):
             raise ValueError(&quot;Device has no image or its path is invalid&quot;)

         Gtk.Container.__init__(self, *args, **kwargs)
@@ -118,8 +119,8 @@ class MouseMap(Gtk.Container):
         self._children = []
         self._highlight_element = None

-        self._handle = Rsvg.Handle.new_from_file(ratbagd_device.svg_path)
-        self._svg_data = etree.parse(ratbagd_device.svg_path)
+        self._handle = Rsvg.Handle.new_from_file(svg_path)
+        self._svg_data = etree.parse(svg_path)

         # TODO: remove this when we're out of the transition to toned down SVGs
         device = self._handle.has_sub(&quot;#Device&quot;)
</code></pre>

<p>That was it for this week! You can find the complete resolutions page PR
<a href="https://github.com/libratbag/piper/pull/28">here</a>.  Hopefully it will be merged early next week, so that I
can start on the next page.</p>

<p>This blog post is part of a <a href="/series/gsoc/">series</a>. You can read the next part about the LED
stack page <a href="/blog/gsoc-part-8">here</a> or the previous part
<a href="/blog/gsoc-part-6">here</a>.</p>


                <br>
            </div>
            
            
                <div class="navigation">
                    
                    <div>
                        <img class="icon" src="/img/back.svg" alt="back" />
                        <a href="https://hjdskes.nl/blog/gsoc-part-6/">GSoC part 6: progress!</a>
                    </div>
                    
                    <div style="width: 100%;"></div>
                    
                    <div>
                        <a href="https://hjdskes.nl/blog/gsoc-part-8/">GSoC part 8: the LED stack page</a>
                        <img class="icon" src="/img/next.svg" alt="next" />
                    </div>
                    
                </div>
            
            <br>
            <div class="disqus">
                
            </div>
            
        </div>
    </div>
</div>

<div class="footer column">
    <div class="container">

        

        <div class="copyright">

        
            
                <a href="https://hjdskes.nl/license">Copyright © 2016-2018 Jente Hidskes</a>
            
        

        </div>
        <div class="icons">

        

        
            <a href="https://github.com/Hjdskes" target="_blank">
                <img class="icon" src="https://hjdskes.nl/img/github.svg" alt="github" />
            </a>
        

        

        

        
            <a href="mailto:hjdskes@gmail.com">
                <img class="icon" src="https://hjdskes.nl/img/email.svg" alt="email" />
            </a>
        

        
            <a href="https://hjdskes.nl/index.xml">
                <img class="icon" src="https://hjdskes.nl/img/rss.svg" alt="rss" />
            </a>
        

        </div>
    </div>
</div>




  <script src="https://hjdskes.nl/js/highlight.min.js" defer></script>
  











<script>
  window.onload = function() {
    
      hljs.initHighlighting();
    
    
    
  };
</script>




</body>
</html>

